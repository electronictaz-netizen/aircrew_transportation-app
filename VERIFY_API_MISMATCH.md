# Verify API Mismatch - Booking Requests Not Showing

## The Problem

The frontend is querying a **different AppSync API** than where the booking request was created. This is why the query returns an empty array even though the booking request exists.

## Current Situation

Based on the network logs and CloudWatch logs:

1. **Frontend is calling:** `ucwy5mmmyrh2rjz6hhkolzwnke`
2. **Booking request was created in:** `ukoh7tgmwjbjdhnuirxugqx4ci` (from CloudWatch logs)
3. **amplify_outputs.json shows:** `qft7xoddfrfp7gslj5t5alhjaa`

These are **three different APIs**! This is why booking requests aren't showing.

## Step 1: Verify Which API the Booking Request Is In

### Check DynamoDB

1. Go to **AWS DynamoDB** → **Tables**
2. Look for tables matching these patterns:
   - `BookingRequest-ucwy5mmmyrh2rjz6hhkolzwnke-*`
   - `BookingRequest-ukoh7tgmwjbjdhnuirxugqx4ci-*`
   - `BookingRequest-qft7xoddfrfp7gslj5t5alhjaa-*`

3. In each table, search for booking request ID: `acf272b0-4bff-4817-9ecd-99d6457d7a83` (from CloudWatch logs)

**The table that contains this booking request is the correct API.**

## Step 2: Verify Which API the Frontend Should Use

### Check Browser Console

1. Open the Management dashboard
2. Open browser DevTools → **Console**
3. Look for: `[Amplify Config] AppSync API ID: ...`
4. This shows which API the frontend is configured to use

### Check amplify_outputs.json

1. The `amplify_outputs.json` file in the repo should have the correct API
2. But the **deployed frontend** might be using a cached/old version
3. The frontend build needs to use the `amplify_outputs.json` generated by the **most recent backend build**

## Step 3: Verify Which API the Backend Deployed To

### Check CloudFormation

1. Go to **AWS CloudFormation** → **Stacks**
2. Find stack: `amplify-d1wxo3x0z5r1oq-main-branch-86729da96e-data7552DF31-*`
3. Look for the AppSync API resource
4. Check the API ID in the stack outputs

### Check AppSync Console

1. Go to **AWS AppSync** → **APIs**
2. Find the API that has the `listBookingRequestsForCompany` query
3. Note the API ID

## Step 4: Fix the Mismatch

### Option A: Frontend Using Wrong API (Cached amplify_outputs.json)

**If the frontend is using a cached/old `amplify_outputs.json`:**

1. **Trigger a frontend rebuild** in Amplify Hosting
2. Make sure the backend build completes **first** (so `amplify_outputs.json` is updated)
3. Then trigger the frontend build
4. The frontend build should use the `amplify_outputs.json` from the backend build

### Option B: Backend Deploying to Wrong API

**If the backend is deploying to a different API than expected:**

1. Check if there are multiple Amplify apps or branches
2. Verify the `AWS_APP_ID` and `AWS_BRANCH` environment variables in Amplify Hosting
3. Make sure the backend is deploying to the correct app/branch

### Option C: Multiple Backend Deployments

**If there are multiple backend deployments:**

1. Identify which backend deployment is "active"
2. Make sure the frontend uses the `amplify_outputs.json` from the active backend
3. Consider cleaning up old/unused backend deployments

## Step 5: Verify the Query Works

Once the APIs match:

1. **Test the query in AppSync Console:**
   - Go to the **correct** AppSync API (where the booking request exists)
   - **Queries** tab
   - Sign in
   - Run:
   ```graphql
   query {
     listBookingRequestsForCompany(companyId: "b5370862-2a4f-4f8a-9f84-174dea888e08") {
       id
       customerName
       customerEmail
       status
       companyId
     }
   }
   ```

2. **If the query works in AppSync Console but not in frontend:**
   - The frontend is still using the wrong API
   - Check browser console for `[Amplify Config] AppSync API ID`
   - Verify it matches the API where the booking request exists

## Quick Diagnostic

**Run this in browser console on the Management dashboard:**

```javascript
// Check which API Amplify is configured to use
const amplifyConfig = window.__AMPLIFY_CONFIG__ || {};
console.log('Amplify API URL:', amplifyConfig.data?.url);

// Or check the actual network request
// Open Network tab → Find GraphQL request → Check Request URL
```

**The API ID in the Request URL should match the API where the booking request exists.**

## Most Likely Solution

Based on the evidence:

1. **Booking request exists in:** `ukoh7tgmwjbjdhnuirxugqx4ci`
2. **Frontend is calling:** `ucwy5mmmyrh2rjz6hhkolzwnke`
3. **Solution:** The frontend needs to be rebuilt to use the correct `amplify_outputs.json`

**Action:** Trigger a **frontend rebuild** in Amplify Hosting after the backend build completes. The frontend build should pick up the `amplify_outputs.json` generated by the backend build, which should point to the correct API.
